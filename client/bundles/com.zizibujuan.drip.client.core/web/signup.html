<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link type="text/css" rel="stylesheet" href="/dijit/themes/claro/claro.css" />
<link type="text/css" rel="stylesheet" href="/dojo/resources/dojo.css" />
<link type="text/css" rel="stylesheet" href="/resources/main.css" />
<title>新用户注册 · 孜孜不倦</title>
<script type="text/javascript" 
	data-dojo-config="
		async:true,
		parseOnLoad:true,
		isDebug:true" 
	src="/dojo/dojo.js"></script>
<script type="text/javascript">
require(["dojo/ready",
         "dojo/dom-form",
         "dojo/store/JsonRest",
         "dijit/registry",
         "dijit/form/Form",
         "dijit/form/ValidationTextBox",
         "dijit/form/Button",
         "dojo/parser",
         "dojo/domReady!"],function(
        		 ready,
        		 domForm,
        		 JsonRest,
        		 registry){
	
	ready(function(){
		var btnSignup = registry.byId("btnSignup");
		btnSignup.on("click", function(e){
			// 注册用户
			//		客户端校验
			//		服务器端校验
			//		服务器端注册
			//		注册成功后，跳转到首页
			//		注册失败后，留在原处，并给出错误信息。
			var jsonRest = new JsonRest({
				target : "/users/"
			});
			var widgetUserForm = registry.byId("userForm");
			if(widgetUserForm.validate()){
				var userInfo = domForm.toObject(widgetUserForm.domNode);
				jsonRest.add(userInfo).then(function(response){
					// 创建成功
					if(response.status == "1"){
						// 注册成功，且登录成功
						//		跳转到个人专属的首页，但是也地址上还是使用根路径。
						//		所以同样的欢迎页面，登录与不登录是不一样的。
						window.location.href = "/"; 
					}else if(response.status == "2"){
						// 注册成功，但登录失败
					}else{
						
					}
				
				},function(error){
					// 创建失败	
					console.log(error);
				});
			}
			
			// signup_check 对每个输入框单独的校验
		});
	});
	
});
</script>

<style type="text/css">
.login_label{
	font-size: 14px;font-weight: bold;
}
</style>
</head>
<body class="claro">
	<div style="width: 100%; padding-top: 80px">
		<div style="margin:0 auto;width: 450px; margin-bottom: 20px; font-size: 14px">
			<h2 style="font-size: 22px; font-weight: bold">注册<span style="color: #FF9630;">孜孜不倦</span>帐号</h2>
			<p>如果您已拥有孜孜不倦帐号，请<a href="/">在此登录</a></p>
		</div>
		<div data-dojo-type="dijit/form/Form" style="margin:0 auto;width: 400px" id="userForm">
			<div>
				<span class="login_label">注册邮箱</span>
				<div data-dojo-type="dijit/form/ValidationTextBox" 
				style = "padding: 8px; width: 290px;margin-bottom: 6px;margin-top: 6px"
				data-dojo-props="'name':'email','required':true,'regExp':'[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}'"></div>
			</div>
			<!-- TODO：密码长度和强度 -->
			<div>
				<span class="login_label">登录密码</span>
				<div data-dojo-type="dijit/form/ValidationTextBox" 
				style = "padding: 8px; width: 290px;margin-bottom: 6px;margin-top: 6px"
				data-dojo-props="'name':'password','type':'password','required':true"></div>
			</div>
			<!-- TODO：确认密码的比较 -->
			<div>
				<span class="login_label">确认密码</span>
				<div data-dojo-type="dijit/form/ValidationTextBox" 
				style = "padding: 8px; width: 290px;margin-bottom: 6px;margin-top: 6px"
				data-dojo-props="'name':'repassword','type':'password','required':true"></div>
			</div>
			<div>
				<span class="login_label">真实姓名</span>
				<div data-dojo-type="dijit/form/ValidationTextBox" 
				style = "padding: 8px; width: 290px;margin-bottom: 6px;margin-top: 6px"
				data-dojo-props="'name':'realName','required':true"></div>		
			</div>
			<!-- TODO:未来版本中加
			<div>
				<span>验证码</span>
				<div data-dojo-type="dijit/form/ValidationTextBox"></div>		
			</div>
			-->
			<div>
				<div data-dojo-type="dijit/form/Button" id="btnSignup" style="font-size: 20px">立即开通</div>
			</div>
		</div>
	</div>
	
</body>
</html>